<launch>
    <!-- Task and logging arguments -->
    <arg name="task_type"/>
    <arg name="bandits_logging_enabled"                 default="true"/>
    <arg name="controller_logging_enabled"              default="false"/>
    <arg name="test_id"                                 default="default"/>
    <arg name="task_max_time_override"                  default="false"/>
    <arg name="task_max_time"                           if="$(arg task_max_time_override)"/>

    <!-- Simulator arguments -->
    <arg name="launch_simulator"                        default="true"/>
    <arg name="start_bullet_viewer"                     default="false"/>
    <arg name="screenshots_enabled"                     default="false"/>

    <!-- Planner/Tester visualization arguments -->
    <arg name="disable_all_visualizations"              default="false"/>
    <arg name="visualize_gripper_motion"                default="false"/>

    <!-- Planner/Tester internal arguments -->
    <arg name="launch_tester"                           default="true"/>
    <arg name="use_random_seed"                         default="false"/>
    <arg name="static_seed_override"                    default="false"/>
    <arg name="static_seed"                             default="156f1ba9b0fbafe2" if="$(arg static_seed_override)"/>

    <!-- Setup task parameters -->
    <include file="$(find deformable_manipulation_experiment_params)/launch/$(arg task_type)_params.launch"/>
    <param name="log_folder"                            value="$(find smmap)/logs/$(arg task_type)/$(arg test_id)/"         type="string"/>

    <!-- Setup the simulator -->
    <group ns="deform_simulator_node">
        <param name="start_bullet_viewer"               value="$(arg start_bullet_viewer)"      type="bool"/>
        <param name="screenshots_enabled"               value="$(arg screenshots_enabled)"      type="bool"/>
        <param name="settle_time"                       value="4.0"/>
        <param name="tf_wait_time"                      value="0.0"/>
    </group>
    <env name="OSG_FILE_PATH" value="$(find OpenSceneGraph)/data"/>
    <node name="deform_simulator_node" pkg="deform_simulator" type="custom_scene_node" required="true" if="$(arg launch_simulator)"/>

    <!-- Setup the planner -->
    <group ns="transition_learning_data_generation_node">
        <param name="use_random_seed"                   value="$(arg use_random_seed)"                      type="bool"/>
        <param name="static_seed"                       value="$(arg static_seed)"                          type="string"   if="$(arg static_seed_override)"/>
        <param name="generate_test_data"                value="false"                                       type="bool"/>
        <param name="generate_transitions"              value="false"                                       type="bool"/>
        <param name="generate_meaningful_mistakes"      value="true"                                        type="bool"/>
        <param name="data_folder" value="/mnt/big_narstie_data/dmcconac/transition_learning_data_generation" type="string"/>

        <param name="disable_all_visualizations"        value="$(arg disable_all_visualizations)"           type="bool"/>
        <param name="visualize_gripper_motion"          value="$(arg visualize_gripper_motion)"             type="bool"/>

        <group ns="rrt">
            <param name="timeout"                           value="600.0"                   type="double"/>
            <param name="reuse_old_results"                 value="false"                   type="bool"/>
            <param name="store_new_results"                 value="false"                   type="bool"/>

            <param name="use_brute_force_nn"                value="false"                   type="bool"/>
            <param name="kd_tree_grow_threshold"            value="500"                     type="int"/>

            <param name="forward_tree_extend_iterations"    value="10"                      type="int"/>
            <param name="backward_tree_extend_iterations"   value="10"                      type="int"/>
            <param name="goal_bias"                         value="0.10"                    type="double"/>
            <param name="use_cbirrt_style_projection"       value="false"                   type="bool"/>
            <param name="best_near_radius"                  value="0.001"                   type="double"/>

            <param name="band_dist2_scaling_factor"         value="0.000001"                type="double"/>
            <param name="band_max_points_"                  value="500"                     type="double"/>

            <param name="feasibility_distance_scale_factor" value="0.0"                     type="double"/>

            <!-- Used to test shortcut smoothing -->
            <param name="use_stored_path"                   value="false"                   type="bool"/>
            <param name="path_file_name_prefix"             value="rrt_path"                type="string"/>
            <param name="path_file_name_suffix_to_load"     value="before_blacklisting_root_idx_4__2019-01-24__13-55-48"     type="string"/>
        </group>

        <group ns="band">
            <param name="logging_enabled"               value="$(arg bandits_logging_enabled)"                              type="bool"/>
            <param name="log_folder"                    value="$(find smmap)/logs/$(arg task_type)/$(arg test_id)/"         type="string"/>
        </group>

        <group ns="rrt">
            <param name="min_gripper_distance_to_obstacles" value="0.03"                        type="double"/>
            <param name="band_max_points_"                  value="500"                         type="double"/>
        </group>

        <group ns="transition_estimation">
            <param name="default_propagation_confidence"        value="1.0"                     type="double"/>
            <param name="default_band_dist_threshold"           value="1.0"                     type="double"/>
            <param name="confidence_threshold"                  value="0.2"                     type="double"/>
            <param name="template_misalignment_scale_factor"    value="1.0"                     type="double"/>
            <param name="tighten_delta_scale_factor"            value="1.0"                     type="double"/>
            <param name="homotopy_changes_scale_factor"         value="1.0"                     type="double"/>
            <param name="use_stored_transitions"                value="false"                   type="bool"/>
            <param name="file_name_prefix"                      value="../learned_transitions"  type="string"/>
            <rosparam>
                file_name_suffixes_to_load: [""]
            </rosparam>
        </group>
    </group>
    <node name="transition_learning_data_generation_node" pkg="smmap" type="transition_learning_data_generation_node" required="true" if="$(arg launch_tester)"/>
</launch>
